// Add cards to table
var memoryEntity = document.querySelector('#cardStack');
var card1 = document.createElement('a-entity');
var card2 = document.createElement('a-entity');
var card3 = document.createElement('a-entity');
var card4 = document.createElement('a-entity');
var card5 = document.createElement('a-entity');
var card6 = document.createElement('a-entity');
var card7 = document.createElement('a-entity');
var card8 = document.createElement('a-entity');
var card9 = document.createElement('a-entity');
var card10 = document.createElement('a-entity');
var card11 = document.createElement('a-entity');
var card12 = document.createElement('a-entity');
var card13 = document.createElement('a-entity');
var card14 = document.createElement('a-entity');
var card15 = document.createElement('a-entity');
var card16 = document.createElement('a-entity');
var card17 = document.createElement('a-entity');
var card18 = document.createElement('a-entity');
var card19 = document.createElement('a-entity');

AFRAME.utils.entity.setComponentProperty(card1, 'position', {x: 0, y: 0.5, z: 0});
AFRAME.utils.entity.setComponentProperty(card1, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card1, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card1, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card2, 'position', {x: 0, y: 0.505, z: 0});
AFRAME.utils.entity.setComponentProperty(card2, 'rotation', {x: 0, y: 2, z: 0});
AFRAME.utils.entity.setComponentProperty(card2, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card2, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card2, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card3, 'position', {x: 0, y: 0.51, z: 0});
AFRAME.utils.entity.setComponentProperty(card3, 'rotation', {x: 0, y: 4, z: 0});
AFRAME.utils.entity.setComponentProperty(card3, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card3, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card3, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card4, 'position', {x: 0, y: 0.515, z: 0});
AFRAME.utils.entity.setComponentProperty(card4, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card4, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card4, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card5, 'position', {x: 0, y: 0.52, z: 0});
AFRAME.utils.entity.setComponentProperty(card5, 'rotation', {x: 0, y: 2, z: 0});
AFRAME.utils.entity.setComponentProperty(card5, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card5, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card5, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card6, 'position', {x: 0, y: 0.525, z: 0});
AFRAME.utils.entity.setComponentProperty(card6, 'rotation', {x: 0, y: 3, z: 0});
AFRAME.utils.entity.setComponentProperty(card6, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card6, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card6, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card7, 'position', {x: 0, y: 0.53, z: 0});
AFRAME.utils.entity.setComponentProperty(card7, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card7, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card7, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card8, 'position', {x: 0, y: 0.535, z: 0});
AFRAME.utils.entity.setComponentProperty(card8, 'rotation', {x: 0, y: 5, z: 0});
AFRAME.utils.entity.setComponentProperty(card8, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card8, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card8, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card9, 'position', {x: 0, y: 0.54, z: 0});
AFRAME.utils.entity.setComponentProperty(card9, 'rotation', {x: 0, y: 4, z: 0});
AFRAME.utils.entity.setComponentProperty(card9, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card9, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card9, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card10, 'position', {x: 0, y: 0.545, z: 0});
AFRAME.utils.entity.setComponentProperty(card10, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card10, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card10, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card11, 'position', {x: 0, y: 0.55, z: 0});
AFRAME.utils.entity.setComponentProperty(card11, 'rotation', {x: 0, y: 1, z: 0});
AFRAME.utils.entity.setComponentProperty(card11, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card11, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card11, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card12, 'position', {x: 0, y: 0.555, z: 0});
AFRAME.utils.entity.setComponentProperty(card12, 'rotation', {x: 0, y: 3, z: 0});
AFRAME.utils.entity.setComponentProperty(card12, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card12, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card12, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card13, 'position', {x: 0, y: 0.56, z: 0});
AFRAME.utils.entity.setComponentProperty(card13, 'rotation', {x: 0, y: 5, z: 0});
AFRAME.utils.entity.setComponentProperty(card13, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card13, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card13, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card14, 'position', {x: 0, y: 0.565, z: 0});
AFRAME.utils.entity.setComponentProperty(card14, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card14, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card14, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card15, 'position', {x: 0, y: 0.57, z: 0});
AFRAME.utils.entity.setComponentProperty(card15, 'rotation', {x: 0, y: 3, z: 0});
AFRAME.utils.entity.setComponentProperty(card15, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card15, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card15, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card16, 'position', {x: 0, y: 0.575, z: 0});
AFRAME.utils.entity.setComponentProperty(card16, 'rotation', {x: 0, y: 5, z: 0});
AFRAME.utils.entity.setComponentProperty(card16, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card16, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card16, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card17, 'position', {x: 0, y: 0.58, z: 0});
AFRAME.utils.entity.setComponentProperty(card1, 'rotation', {x: 0, y: 3, z: 0});
AFRAME.utils.entity.setComponentProperty(card17, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card17, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card17, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card18, 'position', {x: 0, y: 0.585, z: 0});
AFRAME.utils.entity.setComponentProperty(card1, 'rotation', {x: 0, y: 2, z: 0});
AFRAME.utils.entity.setComponentProperty(card18, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card18, 'scale', {x: 0.17, y: 0.005, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card18, 'material', 'color: white');

AFRAME.utils.entity.setComponentProperty(card19, 'position', {x: 0, y: 0.59, z: 0});
AFRAME.utils.entity.setComponentProperty(card19, 'geometry', 'primitive: box');
AFRAME.utils.entity.setComponentProperty(card19, 'scale', {x: 0.17, y: 0.001, z: 0.1});
AFRAME.utils.entity.setComponentProperty(card19, 'material', 'color: white');

memoryEntity.appendChild(card1);
memoryEntity.appendChild(card2);
memoryEntity.appendChild(card3);
memoryEntity.appendChild(card4);
memoryEntity.appendChild(card5);
memoryEntity.appendChild(card6);
memoryEntity.appendChild(card7);
memoryEntity.appendChild(card8);
memoryEntity.appendChild(card9);
memoryEntity.appendChild(card10);
memoryEntity.appendChild(card11);
memoryEntity.appendChild(card12);
memoryEntity.appendChild(card13);
memoryEntity.appendChild(card14);
memoryEntity.appendChild(card15);
memoryEntity.appendChild(card16);
memoryEntity.appendChild(card17);
memoryEntity.appendChild(card18);
memoryEntity.appendChild(card19);


// memory game
// some of this is adapted from https://codepen.io/natewiley/pen/HBrbL

var tries = 0;

$('.memoryCard').on('click', function turnCard() {
  var card = '#' + $(this).closest("a-box").attr('id');
  var cardEntity = document.querySelector(card);
  var imageId = '#' + $(this).closest("a-box").children("a-image").attr('id');
  var imageEntity = document.querySelector(imageId);

  var cardType = '#' + $(this).closest("a-box").children("a-image").attr('name');

  if (tries == 0) {
    tries = 1;
    first = cardType;
    firstImage = imageEntity;
    firstCard = card;
    firstCardEntity = cardEntity;
    console.log("First: " + first);

    triggerEvent = "turnCard";
    document.querySelector(card).emit(triggerEvent);
    setTimeout(function() {
      AFRAME.utils.entity.setComponentProperty(cardEntity, 'color', 'white')
      AFRAME.utils.entity.setComponentProperty(imageEntity, 'visible', 'true');
    }, 1200);
  }
  else if (tries == 1 && card != firstCard) {
    tries = 0;
    second = cardType;
    secondImage = imageEntity;
    secondCard = card;
    secondCardEntity = cardEntity;
    console.log("Second: " + second);

    triggerEvent = "turnCard";
    document.querySelector(card).emit(triggerEvent);
    setTimeout(function() {
      AFRAME.utils.entity.setComponentProperty(cardEntity, 'color', 'white')
      AFRAME.utils.entity.setComponentProperty(imageEntity, 'visible', 'true');
    }, 1200);

    if (first == second) {
      console.log("Hurra!")
    }
    else {
      setTimeout(function() {
        triggerEvent = "turnCard";
        document.querySelector(firstCard).emit(triggerEvent);
        document.querySelector(secondCard).emit(triggerEvent);

        setTimeout(function() {
          AFRAME.utils.entity.setComponentProperty(firstImage, 'visible', false);
          AFRAME.utils.entity.setComponentProperty(secondImage, 'visible', false);
          AFRAME.utils.entity.setComponentProperty(firstCardEntity, 'color', '#eb2348');
          AFRAME.utils.entity.setComponentProperty(secondCardEntity, 'color', '#eb2348');
        }, 1200);
      }, 3500);
    }
  }
});

var cards = [
  document.querySelector('#mcard1'),
  document.querySelector('#mcard2'),
  document.querySelector('#mcard3'),
  document.querySelector('#mcard4'),
  document.querySelector('#mcard5'),
  document.querySelector('#mcard6'),
  document.querySelector('#mcard7'),
  document.querySelector('#mcard8'),
  document.querySelector('#mcard9'),
  document.querySelector('#mcard10'),
  document.querySelector('#mcard11'),
  document.querySelector('#mcard12'),
  document.querySelector('#mcard13'),
  document.querySelector('#mcard14'),
  document.querySelector('#mcard15'),
  document.querySelector('#mcard16')
]

var images = [
  {
		name: "html5",
    img: '../../assets/icons/html5-logo.png',
	},
  {
		name: "html5",
    img: '../../assets/icons/html5-logo.png',
	},
  {
		name: "autodesk",
    img: '../../assets/icons/autodesk_logo.png',
	},
  {
    name: "autodesk",
    img: '../../assets/icons/autodesk_logo.png',
  },
  {
    name: "github",
    img: '../../assets/icons/github-logo.png',
  },
  {
    name: "github",
    img: '../../assets/icons/github-logo.png',
  },
  {
    name: "css3",
    img: '../../assets/icons/css3-logo.png',
  },
  {
    name: "css3",
    img: '../../assets/icons/css3-logo.png',
  },
  {
    name: "slack",
    img: '../../assets/icons/slack-logo.png',
  },
  {
    name: "slack",
    img: '../../assets/icons/slack-logo.png',
  },
  {
    name: "aframe",
    img: '../../assets/icons/aframe-logo.png',
  },
  {
    name: "aframe",
    img: '../../assets/icons/aframe-logo.png',
  },
  {
    name: "nodejs",
    img: '../../assets/icons/nodejs-logo.png',
  },
  {
    name: "nodejs",
    img: '../../assets/icons/nodejs-logo.png',
  },
  {
    name: "jquery",
    img: '../../assets/icons/jquery-logo.png',
  },
  {
    name: "jquery",
    img: '../../assets/icons/jquery-logo.png',
  }
]
randomizeImages();

for (var i, j = 0; i, j < cards.length; i++, j++) {
  card = cards[i];
  image = images[j];
  AFRAME.utils.entity.setComponentProperty(card, 'src', image.img);
  AFRAME.utils.entity.setComponentProperty(card, 'id', 'm-image' + i);
  AFRAME.utils.entity.setComponentProperty(card, 'name', image.name);
}

// randomize array of images
function randomizeImages(){
  Array.prototype.randomize = function()
  {
    var i = this.length, j, temp;
    while ( --i )
    {
      j = Math.floor( Math.random() * (i - 1) );
      temp = this[i];
      this[i] = this[j];
      this[j] = temp;
    }
  };

  images.randomize();
}
